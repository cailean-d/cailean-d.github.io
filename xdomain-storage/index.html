<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <style>
        #receiver {
            display: none;
        }
    </style>
</head>
<body>
    <iframe id="receiver" src="iframe.html"></iframe>

    <!-- <p>
        <input type="text" id="key" placeholder="key">
        <input type="text" id="value" placeholder="value">
        <button id="send">Send Data</button>
        <button id="rec">Rec Data</button>
    </p> -->

    <form id="form1">
        <input type="text" name="name" placeholder="name">
        <input type="text" name="phone" placeholder="phone">
        <input type="submit" value="Send">
    </form>
        

    <script>
    
        const iframe = document.getElementById('receiver')
        const form = document.querySelector('#form1');
        const nameField = form.querySelector('[name=name]');
        const phoneField = form.querySelector('[name=phone]')

        form.onsubmit = _ => {
            setData('form', { name: nameField.value, phone: phoneField.value });
        }

        // document.querySelector('#rec').onclick = _ => {
        //     getData(key.value);
        // }

        
        window.addEventListener("message", messageHandler, false);
        getData('form');

        function messageHandler(e) {

            const { action, key, value } = e.data

            if (action == 'returnData'){
                // console.log(key, data);
                // alert(key + ' = ' + data)

                if (value && key == 'form') {
                    nameField.value = data.name;
                    phoneField.value = data.phone;
                }
            }
        }

        function setData(key, value) {
            iframe.contentWindow.postMessage({ action: 'save', key: key, value: value }, '*')
        }

        function getData(key) {
            iframe.contentWindow.postMessage({ action: 'get', key: key }, '*')
        }
    </script>
</body>
</html>